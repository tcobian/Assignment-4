---
title: 'Assignment 4'
author: "Tyler Cobian, Sara Orofino, Alex Ivina"
date: "November 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyverse)
library(knitr)
library(plotly)
install.packages("vcdExtra")
library(vcdExtra)
library(car)
library(onewaytests)
lobster_size_abundance<-read_csv("lobster_size_abundance.csv")
lobster_traps<- read_csv("lobster_traps (1).csv")

#read in tidyverse and knitr packeges (what other packages do you think we will need?)
#load data for lobster size and abundance and name it "lobster_size_abundance" 
#load data for lobster fishing pressure and name it "lobster_traps"

```

##1. Lobster abundance and fishing pressure
```{r}
#basic data wrangling
lobster_traps_1<-lobster_traps %>% 
  select(YEAR,SITE,TRAPS) %>% 
  filter(SITE == "AQUE" | SITE == "CARP" | SITE == "IVEE" | SITE == "MOHK" | SITE == "NAPL")

#just keep Year Site and Trap data

lobster_1<- lobster_size_abundance %>% 
  filter(SIZE != -99999) %>% 
  select(SITE,YEAR,MONTH,SIZE,COUNT) 
#took out the -99999 values out of lobster_size_abundance under size because this means it was not recorded
#Only kept Year, Month, Size and Count data
  
lobster_1$MONTH<- (month.abb[lobster_1$MONTH])
#change numerical months in "lobster_1" to three letter abbreviation

lobster_traps$MONTH<- (month.abb[lobster_traps$MONTH])
#change numerical months in "lobster_traps" to three letter abbreviation
```


```{r}
#graph for each site relating count to year
abundance_graph<-ggplot(lobster_1, aes(x = YEAR, y = COUNT))+
  geom_point(aes(color = COUNT), show.legend = "false", alpha = 0.5)+
  facet_wrap(~SITE, scales = "free")+
  scale_y_continuous(name = "number of lobsters", limits = c(0,25))+
  theme_classic()
abundance_graph
ggplotly(abundance_graph)


#graph relating fishing pressure (number of traps) for each site by year

pressure_graph<- ggplot(lobster_traps_1, aes(x = YEAR, y = TRAPS))+
  geom_point(aes(color = TRAPS), show.legend = "false", alpha = 0.5)+
  facet_wrap(~SITE, scales = "free")+
  scale_y_continuous(name = "number of traps", limits = c(0,25))+
  theme_classic()
pressure_graph
ggplotly(pressure_graph)

```


2. Compare mean lobster size by site in 2017

```{r}
#Use lobster_1 df for mean size data
# Use and ANOVA
# maybe a posthoc test

lobster_2<- lobster_1 %>% 
  as.data.frame() %>%
  expand.dft(freq = "COUNT") 

lobster_2

variance<- lobster_2 %>% 
  group_by(SITE) %>% 
  summarize(variance = var(SIZE))
variance

#This shows that the lowest variance is less than 4  times smaller than the largest variance, so we can use a one way ANOVA

#Do an Levene test to see if variances are equal
lobster_levene<- leveneTest(SIZE ~ SITE, data = lobster_2)
lobster_levene

#The variances are not equal

# Run ANOVA to see if means are equal

lobster_ANOVA<- aov(SIZE ~ SITE, data = lobster_2) 

summary(lobster_ANOVA)

# reject null hypothesis, at least two samples are from sites with different means

# Use Tukeyhsd to find out which means are different

lobster_hsd<- TukeyHSD(lobster_ANOVA)
lobster_hsd

# CARP and AQUE are not different
# IVEE and AQUE are not different
# IVEE and CARP are not different

# create a graphic to show differences in means

#finding sd to put in error bars in graph
site_summary<- lobster_2 %>% 
  group_by(SITE) %>% 
  summarize(sd = sd(SIZE),
            mean = mean(SIZE))
site_summary

lobster_bar<- ggplot(site_summary, aes(x = SITE, y = mean))+
  geom_col()+
  geom_errorbar(aes(ymin = mean-sd, ymax = mean+sd))
lobster_bar


```





